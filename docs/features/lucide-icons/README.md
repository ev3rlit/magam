# Lucide 아이콘 기능 PRD (Magam)

> ⚠️ **문서 상태(업데이트):** `icon` prop 기반 v1 계획은 종료되었습니다.
> 현재 표준은 `docs/features/shape-composition-lucide/README.md`의 children 선언형 모델입니다.
> `icon` prop은 breaking change로 제거되었으며, 신규 문서/예제는 children 선언형만 사용합니다.

## 1. 배경

현재 Magam의 노드 표현은 텍스트/색상 중심이라, 노드 의미를 빠르게 식별하기 어렵습니다.
특히 보드가 커질수록 "이 노드가 작업/경고/아이디어/완료 중 무엇인지"를 한눈에 파악하기 힘들어집니다.

Lucide 아이콘을 도입해 노드에 의미 단서를 부여하면 탐색 속도와 가독성을 동시에 높일 수 있습니다.

---

## 2. 문제 정의

사용자 관점:

1. 노드 종류/상태를 텍스트만 보고 해석해야 해서 인지 비용이 높다.
2. 동일한 유형 노드를 시각적으로 묶기 어렵다.
3. 아이콘을 넣고 싶어도 일관된 방식(검색/선택/적용)이 없다.

제품 관점:

1. 아이콘 적용 규칙(저장 포맷, 렌더 경로, 기본값)이 정해져 있지 않다.
2. 아이콘 검색 UX가 없어 사용할 수 있는 아이콘을 찾기 어렵다.
3. 캔버스 성능을 해치지 않으면서 아이콘 렌더를 제공해야 한다.

---

## 3. 목표와 비목표

### 목표 (Goals)

1. 노드에 Lucide 아이콘을 선택/적용/변경/제거할 수 있다.
2. 아이콘 검색(이름 기반)과 추천(최근/자주 사용)을 제공한다.
3. 아이콘 정보가 문서(노드 데이터)에 저장되어 재로딩 후에도 유지된다.
4. 1,000+ 노드 환경에서도 성능 저하를 최소화한다.

### 비목표 (Non-Goals)

1. 사용자 커스텀 SVG 업로드(1차 제외)
2. 아이콘 애니메이션/모션 효과
3. 다중 선택 일괄 아이콘 적용(1차 제외)
4. 아이콘 마켓/외부 팩 지원

---

## 4. 사용자 시나리오

### 시나리오 A: 노드에 아이콘 추가

1. 사용자가 노드를 선택한다.
2. 속성 패널에서 "아이콘"을 연다.
3. `rocket`을 검색해 선택한다.
4. 노드 제목 왼쪽에 아이콘이 즉시 렌더된다.

### 시나리오 B: 아이콘 변경

1. 이미 아이콘이 있는 노드를 선택한다.
2. 검색창에서 `bug`를 입력해 새 아이콘으로 교체한다.
3. 캔버스와 저장 데이터가 함께 갱신된다.

### 시나리오 C: 아이콘 제거

1. 노드 아이콘 설정에서 "아이콘 제거"를 누른다.
2. 노드가 텍스트-only 상태로 복귀한다.

---

## 5. 기능 요구사항

### FR-1. 아이콘 적용
- 노드별 아이콘 0~1개 설정 가능
- 아이콘은 노드 헤더(제목 왼쪽) 기본 배치

Acceptance Criteria:
- 아이콘 선택 즉시 UI에 반영된다.
- 저장 후 앱 재실행 시 동일 아이콘이 유지된다.

### FR-2. 아이콘 검색
- Lucide 이름 기반 검색 제공(대소문자 비구분)
- 검색 결과는 최대 50개 표시

Acceptance Criteria:
- `arrow` 입력 시 관련 아이콘이 즉시 필터링된다.
- 결과 없음 시 "검색 결과 없음" 상태를 표시한다.

### FR-3. 최근 사용 아이콘
- 최근 선택 아이콘 최대 8개를 로컬 상태로 유지

Acceptance Criteria:
- 아이콘 패널 상단에 최근 아이콘 섹션이 표시된다.
- 최근 목록에서 클릭 시 즉시 적용된다.

### FR-4. 데이터 모델
- 노드 데이터에 `icon` 필드 저장 (예: `icon: "rocket"`)
- 아이콘 미설정 시 `icon` 필드 제거 또는 `null`

Acceptance Criteria:
- 문서 직렬화/역직렬화 과정에서 아이콘 값이 손실되지 않는다.

### FR-5. 접근성
- 아이콘 선택 UI는 키보드 탐색 가능
- 각 아이콘 항목에 접근성 라벨 제공

Acceptance Criteria:
- 방향키/탭/엔터로 선택 가능하다.
- 스크린리더에서 아이콘 이름이 읽힌다.

---

## 6. 비기능 요구사항

1. 성능
- 아이콘 패널 열기 p95 120ms 이하
- 캔버스 렌더에 불필요한 전체 리렌더 유발 금지

2. 안정성
- 유효하지 않은 아이콘 이름 입력 시 안전하게 fallback(미표시)

3. 일관성
- 다크/라이트 테마에서 아이콘 색상 대비 기준 충족

4. 번들 관리
- 가능한 트리셰이킹 전략으로 사용 아이콘만 번들 포함

---

## 7. UX 제안

1. 진입점
- 노드 우측 패널 > Appearance > Icon

2. 패널 구성
- 검색 입력
- 최근 사용 섹션
- 아이콘 그리드(이름 tooltip)
- 제거 버튼

3. 시각 정책
- 기본 크기 16px (노드 크기에 따라 14~18px 범위)
- 텍스트와 8px 간격
- 노드 상태 색상과 충돌 시 중립 색상 우선

---

## 8. 기술 설계 개요

### 8.1 의존성
- `lucide-react` 사용

### 8.2 데이터 구조 예시

```ts
interface NodeData {
  label: string
  // ...existing fields
  icon?: string // lucide icon name, e.g. "rocket"
}
```

### 8.3 렌더링 전략

1. icon name -> 컴포넌트 매핑 테이블 제공
2. 매핑 실패 시 null 렌더
3. 노드 컴포넌트 memo 유지하여 icon 변경 노드만 갱신

### 8.4 검색 전략 (v1)
- 정적 아이콘 목록을 메모리에 로드
- `includes` 기반 단순 매칭 + prefix 우선 정렬

---

## 9. 단계별 구현 계획

### Phase 1: 기반 구축
1. `lucide-react` 의존성 추가
2. 아이콘 매핑/유틸 함수 구현
3. NodeData에 `icon` 필드 반영

### Phase 2: UI 구현
1. 노드 패널 Icon Picker 추가
2. 검색/결과 리스트/선택 동작 구현
3. 제거 동작 구현

### Phase 3: 렌더/저장 연동
1. 노드 헤더 아이콘 렌더 적용
2. 파일 저장/로드 경로와 데이터 동기화
3. 최근 사용 아이콘 저장(local)

### Phase 4: 검증/마무리
1. 단위 테스트(유틸/매핑/검색)
2. 통합 테스트(적용/변경/제거/재로딩)
3. 문서 및 데모 업데이트

---

## 10. 성공 지표

1. 아이콘 기능 사용률: 활성 사용자 세션의 30% 이상
2. 노드 시각 식별 만족도(내부 테스트): 기존 대비 개선
3. 기능 오류율(아이콘 렌더/저장 실패): 1% 미만

---

## 11. 리스크 및 대응

| 리스크 | 영향 | 대응 |
|---|---|---|
| 아이콘 목록 과다로 UX 복잡 | 선택 시간 증가 | 검색 우선 + 최근 사용 노출 |
| 번들 크기 증가 | 초기 로딩 지연 | 트리셰이킹/동적 로딩 검토 |
| 테마 대비 부족 | 가독성 저하 | 테마별 색상 토큰 적용 |
| 잘못된 아이콘 키 저장 | 렌더 누락 | 스키마 검증 + fallback 처리 |

---

## 12. 오픈 질문

1. 아이콘 색상을 노드 컬러와 연동할지, 고정 중립색으로 갈지?
2. 1차에서 카테고리(Arrows, UI, Files 등) 필터를 넣을지?
3. 최근 사용 목록을 프로젝트별로 분리 저장할지?
4. 추후 커스텀 SVG를 지원할 때의 보안 정책(허용 속성/스크립트 차단)은 어떻게 할지?